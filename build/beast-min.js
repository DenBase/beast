"undefined"!=typeof window?window.Beast={}:global.Beast={},function(){Beast._decl={},Beast._declFinished=!1,Beast._httpRequestQueue=[],Beast._bemNodes=[],Beast._reservedDeclProperies={inherits:1,expand:1,mod:1,param:1,domInit:1,domAttr:1,mix:1,on:1,onWin:1,onMod:1,tag:1,noElems:1},Beast.decl=function(e,t){if(t.inherits&&"string"==typeof t.inherits&&(t.inherits=[t.inherits]),t.mix&&"string"==typeof t.mix&&(t.mix=[t.mix]),"undefined"!=typeof Beast._decl[e]){var i=Beast._decl[e];for(item in i)"undefined"==typeof t[item]&&(t[item]=i[item])}return Beast._decl[e]=t,this},Beast.compileDeclarations=function(){function e(t,i,n,s){s.expand&&t.unshift(s.expand),s.param&&t.unshift(function(){this.defineParam(s.param)}),s.mod&&t.unshift(function(){this.defineMod(s.mod)}),s.mix&&t.unshift(function(){this.mix.apply(this,s.mix)}),s.tag&&t.unshift(function(){this.tag(s.tag)}),s.noElems&&t.unshift(function(){this.noElems(s.noElems)}),s.domAttr&&t.unshift(function(){this.domAttr(s.domAttr)}),s.onMod&&t.unshift(function(){for(modName in s.onMod)for(modValue in s.onMod[modName])this.onMod(modName,modValue,s.onMod[modName][modValue])}),s.domInit&&i.unshift(s.domInit),s.on&&i.unshift(function(){for(events in s.on)this.on(events,s.on[events])}),s.onWin&&i.unshift(function(){for(events in s.onWin)this.onWin(events,s.onWin[events])});for(key in s)Beast._reservedDeclProperies[key]||n[key]||(n[key]=s[key]);if(s.inherits)for(var o=s.inherits.length-1,r=0;o>=r;o--){var d=Beast._decl[s.inherits[o]];d&&e(t,i,n,d)}}function t(e,t,i){Beast._decl[i][e]=function(){for(var e=0,i=t.length;i>e;e++)t[e].call(this)}}for(selector in Beast._decl){var i=Beast._decl[selector],n=[],s=[],o={};e(n,s,o,i),t("expand",n,selector),t("domInit",s,selector),i._userMethods=o}},Beast.node=function(e,t){return Beast._declFinished||(Beast._declFinished=!0,Beast.compileDeclarations()),new Beast.BemNode(e,t,Array.prototype.splice.call(arguments,2))},Beast.findNodes=function(){for(var e=[],t=0,i=arguments.length;i>t;t++)for(var n=arguments[t],s=0,o=Beast._bemNodes.length;o>s;s++){var r=Beast._bemNodes[s];r&&r._domClasses.indexOf(n)>=0&&e.push(r)}return e},Beast.require=function(e){function t(){for(var e=!0,t=0,i=Beast._httpRequestQueue.length;i>t;t++){var n=Beast._httpRequestQueue[t];(4!==n.readyState||200!==n.status)&&(e=!1)}if(e){for(var t=0,i=Beast._httpRequestQueue.length;i>t;t++)Beast.appendBML(Beast._httpRequestQueue[t].responseText);Beast._httpRequestQueue=[],Beast.processDOMScripts()}}var i=new XMLHttpRequest;i.open("GET",e),i.onreadystatechange=function(){4===this.readyState&&200===this.status&&t()},i.send(),Beast._httpRequestQueue.push(i)},Beast.appendBML=function(e){var t=Beast.parseBML(e);/^[\s\n]*</.test(e)&&(t+=".render(document.body);");var i=document.createElement("script");i.text=t,document.head.appendChild(i)},Beast.processDOMLinks=function(){for(var e=document.getElementsByTagName("link"),t=0,i=e.length;i>t;t++){var n=e[t];("bml"===n.type||"bml"===n.rel)&&Beast.require(n.href)}},Beast.processDOMScripts=function(){if(0===Beast._httpRequestQueue.length)for(var e=document.getElementsByTagName("script"),t=0,i=e.length;i>t;t++){var n=e[t],s=n.text;"bml"===n.type&&""!==s&&Beast.appendBML(s)}},"undefined"!=typeof document&&document.addEventListener("DOMContentLoaded",function(){Beast.processDOMLinks(),Beast.processDOMScripts()})}(),function(){function e(e){for(var t="",i=0,n=0,s=e.length;s>n;n++){var o=e[n];"{"===o?(i++,1===i?""!==t&&(t+="',"):t+=o):"}"===o?(i--,0===i?s-1>n&&"{"!==e[n+1]&&(t+=",'"):t+=o):0===i?(0===n&&(t+="'"),t+=o,n===s-1&&(t+="'")):t+=o}return t}function t(t,i,n){t=t.substr(1),t=i?t.substr(0,t.length-2):t.substr(0,t.length-1);var o=t.split(s),r=o.shift();""===o[o.length-1]&&o.pop();var d="Beast.node('"+r+"', ";if(o.length||n){for(d+="{",n&&(d+="'context':this",o.length&&(d+=", "));o.length;){var h=o.shift().split("=");d+=1===h.length?"'"+h[0]+"':true":"'"+h[0]+"':"+('""'===h[1]?"''":e(h[1].substr(1,h[1].length-1))),0!==o.length&&(d+=", ")}d+="}"}else d+="null";return i&&(d+=")"),d}function i(i){var s;for(i=i.replace(r,"");;){if(s=n.exec(i),null===s)return i;var d,h=s[0],a=s.index;if("/"===h[h.length-2])d=h.length;else{var l=h.indexOf(" ");0>l&&(l=h.length-1);var _,m=h.substr(1,l-1),c=new RegExp("<"+m+"(?:[s\n][^>]*)*>","g"),u="</"+m+">",f=i.substr(a+1),p=-1;do d=f.search(u),f=f.substr(0,d)+"*"+f.substr(d+1),_=f.substr(0,d).match(c),p++;while(null!==_&&_.length>p);d+=1+u.length}for(var N,f=i.substr(a,d),B="",g="",v=[],k=0,y=f.length;y>k;k++)N=f[k],"\n"!==N&&("<"===N&&(v.push(g),g=""),g+=N,">"===N&&(v.push(g),g=""));""!==g&&v.push(f);for(var x,C=!0,k=0,y=v.length;y>k;k++){var N=v[k];if(!o.test(N)){var b=N.substr(0,1),E=N.substr(0,2),M=N.substr(N.length-1),D=N.substr(N.length-2);if("</"!==E||">"!==M)if(C?(C=!1,x=!0):(B+=", ",x=!1),"<"!==b||"/>"!==D)if("<"!==b||">"!==M){if("<"===b)return console.error("Unclosed node:",N);B+=e(N)}else B+=t(N,!1,x);else B+=t(N,!0,x);else B+=")"}}i=i.substr(0,a)+B+i.substr(a+d)}}var n=/<[a-z][^>]+\/?>/i,s=/\s+(?=[^"]+(?:[=$]|$))|"\s+(?=[^=]*=)|"\s*(?=[^="]*$)/,o=/^[\s]*$/,r=/<!--[^]*-->/g;Beast.parseBML=i}(),function(){function e(e,t,i){this._name="",this._nodeName=e,this._attr=t||{},this._isBlock=!1,this._isElem=!1,this._mod={},this._modHandlers={},this._param={},this._domNode=null,this._domAttr={},this._domClasses=null,this._afterDomInitHandlers=[],this._domInited=!1,this._parentBlock=null,this._forcedParentBlock=!1,this._parentNode=null,this._prevParentNode=null,this._children=[],this._expandedChildren=null,this._isExpanded=!1,this._isExpandContext=!1,this._isReplaceContext=!1,this._mix=[],this._tag="div",this._id="",this._noElems=!1,this._implementedNode=null,this._bemNodeIndex=-1,this._css={};var n=e.substr(0,1);this._isBlock=n===n.toUpperCase(),this._isElem=!this._isBlock,this._isBlock&&(this._name=e.toLowerCase(),this._parentBlock=this,this._defineUserMethods());for(key in this._attr){var n=key.substr(0,1);n===n.toUpperCase()?this._mod[key.toLowerCase()]=this._attr[key]:"mix"===key?this._mix=this._attr.mix.split(" "):"context"!==key||this._parentBlock?"block"===key?(this.parentBlock(this._attr.block,!0),this._forcedParentBlock=!0):"tag"===key?this._tag=this._attr.tag:"id"===key?this._id=this._attr.id:this._param[key]=this._attr[key]:this.parentBlock(this._attr.context)}this.append.apply(this,i)}e.prototype={isBlock:function(){return this._isBlock},isElem:function(){return this._isElem},selector:function(){return this._name},id:function(e){return"undefined"==typeof e?this._id:(this._id=e,this._domNode&&(this._domNode.id=e),this)},tag:function(e){return"undefined"==typeof e?this._tag:(this._domNode||(this._tag=e),this)},css:function(e,i){if("object"==typeof e)for(key in e)this.css(key,e[key]);else{if("undefined"==typeof i)return this._domNode?window.getComputedStyle(this._domNode).getPropertyValue(e):this._css[e];"number"==typeof i&&t[e]&&(i+="px"),this._css[e]=i,this._domNode&&this._setDomNodeCSS()}return this},noElems:function(e){return this._noElems=e,this._setParentBlockForChildren(this,this._parentNode,!0),this},parentBlock:function(t,i){if(t){if(this._isElem&&t instanceof e&&t!==this._parentBlock&&!this._forcedParentBlock){if(t._parentBlock._noElems)return this.parentBlock(t._parentNode,i);this._clearUserMethods(),this._parentBlock=t._parentBlock,this._name=this._parentBlock._name+"__"+this._nodeName,this._defineUserMethods(),i||this._setParentBlockForChildren(this,t)}return this}return this._implementedNode?this._implementedNode._parentBlock:this._parentBlock},parentNode:function(t){return t?(t instanceof e&&(this._prevParentNode=this._parentNode,this._parentNode=t),this):this._parentNode},domNode:function(){return this._domNode},domAttr:function(e,t){if("object"==typeof e)for(key in e)this.domAttr(key,e[key]);else{if("undefined"==typeof t)return this._domAttr[e];this._domAttr[e]=t,this._domNode&&this._domNode.setAttribute(e,t)}return this},mix:function(){for(var e=0,t=arguments.length;t>e;e++)this._mix.push(arguments[e]);return this._domNode&&this._setDomNodeClasses(),this},defineMod:function(e){return this._implementedNode&&this._implementedNode._extendProperty("_mod",e),this._extendProperty("_mod",e)},defineParam:function(e){return this._extendProperty("_param",e)},mod:function(e,t,i){if("object"==typeof e)for(key in e)this.mod(key,e[key]);else{if("undefined"==typeof t)return this._mod[e];this._mod[e]!==t&&(this._mod[e]=t,this._implementedNode&&(this._implementedNode._mod[e]=t),this._domNode&&(this._setDomNodeClasses(),this._callModHandlers(e,t,i)))}return this},param:function(e,t){if("object"==typeof e)for(key in e)this.param(key,e[key]);else{if("undefined"==typeof t)return this._param[e];this._param[e]=t}return this},on:function(e,t){for(var i=e.split(" "),n=0,s=i.length;s>n;n++)!function(e,i){e._domNode.addEventListener(i,function(i){t.call(e,i,i.detail)})}(this,i[n]);return this},onWin:function(e,t){for(var i=e.split(" "),n=0,s=i.length;s>n;n++)!function(e,i){window.addEventListener(i,function(i){t.call(e,i,i.detail)})}(this,i[n]);return this},onMod:function(e,t,i){return"undefined"==typeof this._modHandlers[e]&&(this._modHandlers[e]={}),"undefined"==typeof this._modHandlers[e][t]&&(this._modHandlers[e][t]=[]),this._modHandlers[e][t].push(i),this},trigger:function(e,t){return this._domNode&&this._domNode.dispatchEvent(t?new CustomEvent(e,{detail:t}):new Event(e)),this},triggerWin:function(e,t){return this._domNode&&(e=(this._isBlock?this._name:this._parentBlock._name)+":"+e,window.dispatchEvent(t?new CustomEvent(e,{detail:t}):new Event(e))),this},index:function(){for(var e=this._parentNode._children,t=0,i=e.length;i>t;t++)if(e[t]===this)return t},empty:function(){var t;if(this._isExpandContext?(t=this._expandedChildren,this._expandedChildren=[]):(t=this._children,this._children=[]),t)for(var i=0,n=t.length;n>i;i++)t[i]instanceof e&&t[i]._unlink();if(this._domNode)for(;this._domNode.firstChild;)this._domNode.removeChild(this._domNode.firstChild);return this},remove:function(e){return this._domNode&&this._domNode.parentNode.removeChild(this._domNode),this._parentNode&&(this._parentNode._children=this._parentNode._children.splice(this.index(),1)),e||this._unlink(),this},append:function(){for(var t=0,i=arguments.length;i>t;t++){var n=arguments[t];Array.isArray(n)?this.append.apply(this,n):(n instanceof e?(n.parentNode(this),n._isElem&&(this._isBlock?n.parentBlock(this):this._attr.context&&n.parentBlock(this._parentBlock))):"number"==typeof n&&(n=n.toString()),this._domNode&&!this._isReplaceContext?(this._children.push(n),this._renderChildWithIndex(this._children.length-1)):this._isExpandContext?(this._expandedChildren||(this._expandedChildren=[]),this._expandedChildren.push(n)):this._children.push(n))}return this},appendTo:function(e){return this.remove(!0),e.append(this),this},replaceWith:function(t){this._completeExpand();var i,n=this._parentNode;n===t?n=this._prevParentNode:(i=n._children.splice(this.index()),i.shift()),n._isReplaceContext=!0,n.append(t),n._isReplaceContext=!1,i&&(n._children=n._children.concat(i)),this._parentNode=null,t instanceof e&&(t._isBlock&&t._resetParentBlockForChildren(),t.render())},implementWith:function(e){this._setDomNodeClasses(),e._implementedNode=this,e._extendProperty("_mod",this._mod),this._extendProperty("_mod",e._mod),e._defineUserMethods(this._name),this.replaceWith(e)},text:function(){for(var e="",t=0,i=this._children.length;i>t;t++)"string"==typeof this._children[t]&&(e+=this._children[t]);return e},get:function(){if(0===arguments.length)return this._children;for(var e=[],t=0,i=arguments.length;i>t;t++)for(var n=arguments[t].split("/"),s=0,o=n.length;o>s;s++){var r=n[s];if(0===s)e=this._filterChildNodes(r);else{var d=e;e=[];for(var h=0,a=d.length;a>h;h++)e=e.concat(this._filterChildNodes.call(d[h],r))}if(0===e.length)break}return e},getWithContext:function(){for(var t=this.get.apply(this,argumnets),i=0,n=t.length;n>i;i++)t[i]instanceof e&&t[i].parenBlock(this._parentBlock);return t},has:function(){return this.get.apply(this,arguments).length>0},afterDomInit:function(e){return this._domInited?e.call(this):this._afterDomInitHandlers.push(e),this},render:function(e){if(this._expand(),!e&&!this._parentNode)return this;if(!this._domNode){this._domNode=document.createElement(this._tag),this._domNode.bemNode=this,""!==this._id&&(this._domNode.id=this._id),this._setDomNodeClasses(),this._setDomNodeCSS();for(key in this._domAttr)this._domNode.setAttribute(key,this._domAttr[key])}e?e.appendChild(this._domNode):this._parentNode._domNode.appendChild(this._domNode);for(var t=0,i=this._children.length;i>t;t++)this._renderChildWithIndex(t);this._bemNodeIndex=Beast._bemNodes.length,Beast._bemNodes.push(this);for(modName in this._mod)this._callModHandlers(modName,this._mod[modName]);return this._domInit(),this},renderHTML:function(){var e="";return e},_setParentBlockForChildren:function(t,i,n){for(var s=0,o=t._children.length;o>s;s++){var r=t._children[s];r instanceof e&&r._isElem&&(!r._parentBlock||n?r.parentBlock(i):this._setParentBlockForChildren(r,i))}},_filterChildNodes:function(t){for(var i=[],n=0,s=this._children.length;s>n;n++){var o=this._children[n];o instanceof e&&(""===t||t===o._nodeName||o._implementedNode&&t===o._implementedNode._nodeName)&&i.push(o)}return i},_renderChildWithIndex:function(t){var i=this._children[t];i instanceof e?i.render():this._domNode.appendChild(document.createTextNode(i))},_expand:function(){if(!this._isExpanded){var e=Beast._decl[this._name];e&&(this._isExpandContext=!0,e.expand.call(this),this._completeExpand(),this._isExpandContext=!1)}},_completeExpand:function(){this._isExpandContext&&this._expandedChildren&&(this._children=this._expandedChildren,this._expandedChildren=null),this._isExpanded=!0},_domInit:function(){var e=Beast._decl[this._name];if(e&&e.domInit.call(this),this._implementedNode&&(e=Beast._decl[this._implementedNode._name])&&e.domInit.call(this),this._domInited=!0,0!==this._afterDomInitHandlers.length)for(var t=0,i=this._afterDomInitHandlers.length;i>t;t++)this._afterDomInitHandlers[t].call(this)},_callModHandlers:function(e,t,i,n){var s;if(this._modHandlers[e]&&(this._modHandlers[e][t]?s=this._modHandlers[e][t]:value===!1&&this._modHandlers[name][""]?s=this._modHandlers[e][""]:""===value&&this._modHandlers[name][!1]&&(s=this._modHandlers[e][!1])),s){"undefined"==typeof n&&(n=this);for(var o=0,r=s.length;r>o;o++)s[o].call(n,i)}this._implementedNode&&this._implementedNode._callModHandlers(e,t,i,this)},_extendProperty:function(e,t){var i=this[e];for(key in t)"undefined"!=typeof i[key]&&""!==i[key]?this[e][key]=i[key]:this[e][key]=t[key];return this},_setDomNodeClasses:function(e){var t,i=this._name;for(key in this._mod)t=this._mod[key],""!==t&&t!==!1&&(i+=t!==!0?" "+this._name+"_"+key+"_"+t:" "+this._name+"_"+key);this._implementedNode&&(i+=" "+this._implementedNode._setDomNodeClasses(!0));for(var n=0,s=this._mix.length;s>n;n++)i+=" "+this._mix[n];return e?i:(this._domClasses=i.split(" "),void(this._domNode&&(this._domNode.className=i)))},_setDomNodeCSS:function(){var e="";for(name in this._css)(this._css[name]||0===this._css[name])&&(e+=name+":"+this._css[name]+";");""!==e&&this._domNode.setAttribute("style",e)},_resetParentBlockForChildren:function(){for(var t=0,i=this._children.length;i>t;t++){var n=this._children[t];n instanceof e&&n._isElem&&(n.parentBlock(this._parentBlock),n._resetParentBlockForChildren(this._parentBlock))}},_defineUserMethods:function(){var e=arguments[0]||this._name,t=Beast._decl[e];if(t)for(methodName in t._userMethods)this[methodName]=t._userMethods[methodName]},_clearUserMethods:function(){if(""!==this._name&&Beast._decl[this._name]){var e=Beast._decl[this._name]._userMethods;for(methodName in e)this[methodName]=null}},_unlink:function(){this._bemNodeIndex>=0&&(Beast._bemNodes[this._bemNodeIndex]=null)}},Beast.BemNode=e;var t={height:1,width:1,left:1,right:1,bottom:1,top:1,"line-height":1,"font-size":1}}();